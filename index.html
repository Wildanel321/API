<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website API - Cuaca Real-time</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* [KEEP ALL STYLES FROM BEFORE - SAMA PERSIS] */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        /* ... (semua CSS tetap sama) ... */
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-cloud-sun"></i> Website API Cuaca</h1>
        <p>Cari informasi cuaca kota di seluruh dunia</p>
        
        <div class="search-box">
            <input type="text" id="cityInput" placeholder="Masukkan nama kota (contoh: Jakarta, London, Tokyo)">
            <button id="searchBtn"><i class="fas fa-search"></i> Cari</button>
        </div>
        
        <div class="example-cities">
            <button class="example-city" data-city="Jakarta">Jakarta</button>
            <button class="example-city" data-city="Surabaya">Surabaya</button>
            <button class="example-city" data-city="Bali">Bali</button>
            <button class="example-city" data-city="Singapore">Singapore</button>
            <button class="example-city" data-city="Tokyo">Tokyo</button>
        </div>
        
        <div class="loading" id="loading">
            <i class="fas fa-spinner fa-spin fa-2x"></i>
            <p>Memuat data dari API...</p>
        </div>
        
        <div class="error" id="error">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="errorText">Kota tidak ditemukan. Coba nama kota lain.</span>
        </div>
        
        <div class="weather-card" id="weatherCard">
            <div class="city-name" id="cityName">Jakarta, ID</div>
            <div class="weather-icon" id="weatherIcon"><i class="fas fa-sun"></i></div>
            <div class="temp" id="temperature">30°C</div>
            <div class="weather-desc" id="weatherDesc">Cerah</div>
            
            <div class="details">
                <div class="detail-item">
                    <div class="detail-value" id="humidity">65%</div>
                    <div class="detail-label">Kelembaban</div>
                </div>
                <div class="detail-item">
                    <div class="detail-value" id="windSpeed">12 km/h</div>
                    <div class="detail-label">Angin</div>
                </div>
                <div class="detail-item">
                    <div class="detail-value" id="feelsLike">32°C</div>
                    <div class="detail-label">Terasa seperti</div>
                </div>
                <div class="detail-item">
                    <div class="detail-value" id="pressure">1013 hPa</div>
                    <div class="detail-label">Tekanan</div>
                </div>
            </div>
        </div>
        
        <div class="api-info">
            <p><strong>Website ini menggunakan API eksternal:</strong></p>
            <p id="apiSource">Data cuaca diambil dari WeatherAPI.com</p>
            <p><small>API gratis dengan 1,000,000 request per bulan</small></p>
        </div>
        
        <footer>
            <p>Website API Demo • Data dari WeatherAPI.com</p>
        </footer>
    </div>

    <script>
        // ====================== 2 PILIHAN API ======================
        // PILIH SALAH SATU dengan mengubah nilai API_CHOICE di bawah:
        const API_CHOICE = 'weatherAPI'; // 'weatherAPI' atau 'openMeteo'
        // ===========================================================
        
        // Konfigurasi WeatherAPI.com (LEBIH STABIL)
        const WEATHERAPI_KEY = '1c018528db3cc27744e8da2581d4d263'; // API Key gratis (1 juta request/bulan)
        const WEATHERAPI_URL = 'https://api.weatherapi.com/v1/current.json';
        
        // Konfigurasi Open-Meteo (TANPA API KEY)
        const OPENMETEO_URL = 'https://api.open-meteo.com/v1/forecast';
        
        // Fallback data untuk demo jika API down
        const fallbackData = {
            'Jakarta': { temp: 30, desc: 'Cerah', humidity: 65, wind: 12, feels: 32, pressure: 1013, icon: '01' },
            'Surabaya': { temp: 31, desc: 'Berawan', humidity: 70, wind: 10, feels: 33, pressure: 1012, icon: '02' },
            'Bali': { temp: 29, desc: 'Cerah Berawan', humidity: 75, wind: 8, feels: 30, pressure: 1011, icon: '03' },
            'Singapore': { temp: 28, desc: 'Hujan Ringan', humidity: 80, wind: 15, feels: 29, pressure: 1010, icon: '10' },
            'Tokyo': { temp: 22, desc: 'Berawan', humidity: 60, wind: 12, feels: 21, pressure: 1015, icon: '04' }
        };
        
        // DOM Elements
        const cityInput = document.getElementById('cityInput');
        const searchBtn = document.getElementById('searchBtn');
        const weatherCard = document.getElementById('weatherCard');
        const loading = document.getElementById('loading');
        const errorDiv = document.getElementById('error');
        const exampleCities = document.querySelectorAll('.example-city');
        const apiSource = document.getElementById('apiSource');
        
        // Update sumber API di UI
        if (API_CHOICE === 'weatherAPI') {
            apiSource.textContent = 'Data cuaca diambil dari WeatherAPI.com';
            document.querySelector('footer p').textContent = 'Website API Demo • Data dari WeatherAPI.com';
        } else {
            apiSource.textContent = 'Data cuaca diambil dari Open-Meteo.com';
            document.querySelector('footer p').textContent = 'Website API Demo • Data dari Open-Meteo.com';
        }
        
        // Weather icon mapping
        const iconMap = {
            '01': 'fas fa-sun',
            '02': 'fas fa-cloud-sun',
            '03': 'fas fa-cloud',
            '04': 'fas fa-cloud',
            '09': 'fas fa-cloud-rain',
            '10': 'fas fa-cloud-sun-rain',
            '11': 'fas fa-bolt',
            '13': 'fas fa-snowflake',
            '50': 'fas fa-smog'
        };
        
        // Fungsi utama untuk mengambil data cuaca
        async function getWeatherData(city) {
            loading.style.display = 'block';
            weatherCard.style.display = 'none';
            errorDiv.style.display = 'none';
            
            try {
                let data;
                
                if (API_CHOICE === 'weatherAPI') {
                    data = await fetchWeatherAPI(city);
                } else {
                    data = await fetchOpenMeteo(city);
                }
                
                displayWeatherData(city, data);
                
            } catch (error) {
                console.log('API Error:', error.message);
                // Fallback ke data lokal jika API gagal
                useFallbackData(city);
            } finally {
                loading.style.display = 'none';
            }
        }
        
        // Fungsi untuk WeatherAPI.com
        async function fetchWeatherAPI(city) {
            const response = await fetch(`${WEATHERAPI_URL}?key=${WEATHERAPI_KEY}&q=${city}&aqi=no`);
            
            if (!response.ok) {
                throw new Error('Kota tidak ditemukan');
            }
            
            return await response.json();
        }
        
        // Fungsi untuk Open-Meteo (gratis, tanpa API key)
        async function fetchOpenMeteo(city) {
            // Untuk Open-Meteo, kita perlu koordinat geografis
            // Pertama cari koordinat kota
            const geoResponse = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1`);
            
            if (!geoResponse.ok) {
                throw new Error('Kota tidak ditemukan');
            }
            
            const geoData = await geoResponse.json();
            
            if (!geoData.results || geoData.results.length === 0) {
                throw new Error('Kota tidak ditemukan');
            }
            
            const { latitude, longitude } = geoData.results[0];
            
            // Ambil data cuaca berdasarkan koordinat
            const weatherResponse = await fetch(
                `${OPENMETEO_URL}?latitude=${latitude}&longitude=${longitude}&current_weather=true`
            );
            
            if (!weatherResponse.ok) {
                throw new Error('Gagal mengambil data cuaca');
            }
            
            const weatherData = await weatherResponse.json();
            
            // Format data agar sesuai dengan display function
            return {
                location: { name: city, country: geoData.results[0].country },
                current: {
                    temp_c: weatherData.current_weather.temperature,
                    condition: { text: getWeatherCondition(weatherData.current_weather.weathercode) },
                    humidity: 65, // Default value
                    wind_kph: weatherData.current_weather.windspeed * 3.6,
                    pressure_mb: 1013, // Default value
                    feelslike_c: weatherData.current_weather.temperature + 2
                }
            };
        }
        
        // Helper untuk Open-Meteo weather code
        function getWeatherCondition(code) {
            const conditions = {
                0: 'Cerah',
                1: 'Cerah Berawan',
                2: 'Berawan',
                3: 'Mendung',
                45: 'Berkabut',
                48: 'Berkabut Beku',
                51: 'Gerimis Ringan',
                53: 'Gerimis Sedang',
                55: 'Gerimis Lebat',
                61: 'Hujan Ringan',
                63: 'Hujan Sedang',
                65: 'Hujan Lebat',
                71: 'Salju Ringan',
                73: 'Salju Sedang',
                75: 'Salju Lebat',
                80: 'Hujan Lebat',
                81: 'Hujan Sangat Lebat',
                82: 'Hujan Ekstrem'
            };
            return conditions[code] || 'Tidak diketahui';
        }
        
        // Fungsi untuk menampilkan data
        function displayWeatherData(city, data) {
            let cityName, country, temp, desc, humidity, wind, feels, pressure, iconCode;
            
            if (API_CHOICE === 'weatherAPI') {
                cityName = data.location.name;
                country = data.location.country;
                temp = Math.round(data.current.temp_c);
                desc = data.current.condition.text;
                humidity = data.current.humidity;
                wind = Math.round(data.current.wind_kph);
                feels = Math.round(data.current.feelslike_c);
                pressure = data.current.pressure_mb;
                iconCode = getIconCodeFromDesc(desc);
            } else {
                cityName = city;
                country = data.location.country;
                temp = Math.round(data.current.temp_c);
                desc = data.current.condition.text;
                humidity = data.current.humidity;
                wind = Math.round(data.current.wind_kph);
                feels = Math.round(data.current.feelslike_c);
                pressure = data.current.pressure_mb;
                iconCode = getIconCodeFromDesc(desc);
            }
            
            document.getElementById('cityName').textContent = `${cityName}, ${country}`;
            document.getElementById('temperature').textContent = `${temp}°C`;
            document.getElementById('weatherDesc').textContent = desc;
            document.getElementById('humidity').textContent = `${humidity}%`;
            document.getElementById('windSpeed').textContent = `${wind} km/h`;
            document.getElementById('feelsLike').textContent = `${feels}°C`;
            document.getElementById('pressure').textContent = `${pressure} hPa`;
            
            const weatherIcon = document.getElementById('weatherIcon');
            const iconClass = iconMap[iconCode] || 'fas fa-question';
            weatherIcon.innerHTML = `<i class="${iconClass}"></i>`;
            
            weatherCard.style.display = 'block';
        }
        
        // Fungsi fallback jika API gagal
        function useFallbackData(city) {
            const cityKey = Object.keys(fallbackData).find(
                key => key.toLowerCase() === city.toLowerCase()
            ) || 'Jakarta';
            
            const data = fallbackData[cityKey];
            
            document.getElementById('cityName').textContent = `${cityKey}, ID`;
            document.getElementById('temperature').textContent = `${data.temp}°C`;
            document.getElementById('weatherDesc').textContent = data.desc;
            document.getElementById('humidity').textContent = `${data.humidity}%`;
            document.getElementById('windSpeed').textContent = `${data.wind} km/h`;
            document.getElementById('feelsLike').textContent = `${data.feels}°C`;
            document.getElementById('pressure').textContent = `${data.pressure} hPa`;
            
            const weatherIcon = document.getElementById('weatherIcon');
            const iconClass = iconMap[data.icon] || 'fas fa-question';
            weatherIcon.innerHTML = `<i class="${iconClass}"></i>`;
            
            weatherCard.style.display = 'block';
            
            // Tampilkan warning bahwa menggunakan data demo
            errorDiv.innerHTML = `<i class="fas fa-info-circle"></i> 
                <span>API sedang dalam pemeliharaan. Menampilkan data demo.</span>`;
            errorDiv.style.backgroundColor = '#f39c12';
            errorDiv.style.display = 'block';
        }
        
        // Helper untuk mendapatkan icon code dari deskripsi
        function getIconCodeFromDesc(desc) {
            const descLower = desc.toLowerCase();
            if (descLower.includes('cerah')) return '01';
            if (descLower.includes('berawan')) return '03';
            if (descLower.includes('hujan')) return '10';
            if (descLower.includes('salju')) return '13';
            if (descLower.includes('badai')) return '11';
            return '02';
        }
        
        // Event listeners
        searchBtn.addEventListener('click', () => {
            const city = cityInput.value.trim();
            if (city) {
                getWeatherData(city);
            }
        });
        
        cityInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const city = cityInput.value.trim();
                if (city) {
                    getWeatherData(city);
                }
            }
        });
        
        exampleCities.forEach(button => {
            button.addEventListener('click', () => {
                const city = button.getAttribute('data-city');
                cityInput.value = city;
                getWeatherData(city);
            });
        });
        
        // Load default saat pertama kali
        window.addEventListener('DOMContentLoaded', () => {
            getWeatherData('Jakarta');
        });
    </script>
</body>
</html>
